{
  "hash": "51cc475ab215ac616d96bd748469687c",
  "result": {
    "markdown": "---\ntitle: \"쮺칩mo descargar datos desde GitHub m치s r치pido?\"\ndescription: \"Vemos paso a paso c칩mo descargar archivos desde GitHub usando Python y R. Adem치s, tomamos el tiempo de cu치nto demoran!\"\nauthor: \"Paulo Villarroel\"\ndate: \"2022-10-27\"\ncategories: [tutorial, github, python, r]\nimage: \"descarga.jpg\"\n---\n\n\nHola!!!\n\nEn esta ocasi칩n veremos un tema que me preguntan mucho siempre. Habitualmente cuando hago clases o alg칰n taller de programaci칩n, sale esta duda...\n\n쮺칩mo descargar los archivos desde GitHub?\n\nMe refiero a descargar los archivos csv alojados en GitHub para poder usarlos.\n\nOk.\n\nRevisemos paso a paso c칩mo hacerlo. Y para ello, usar칠 2 lenguajes de programaci칩n que me gustan mucho: Python y R. Adem치s, que si est치s interesado/a en la ciencia de datos, los m치s seguro es que uses alguno de ellos.\n\nAh! Ac치 no voy a revisar c칩mo descargar todo el repositorio remoto desde GitHub (clonarlo), sino a solo un archivo que est칠 ah칤 disponible. Tampoco har칠 un an치lisis de los datos. Ya habr치 momento para eso.\n\nPero haremos algo entretenido, que es medir cu치nto demoran cada uno!! 游땙\n\n## Accediendo a GitHub\n\nPara este tutorial, usar칠 el [repositorio del Ministerio de Ciencias y Tecnolog칤a de Chile](https://github.com/MinCiencia/Datos-COVID19), que contiene muchos datos de los casos COVID-19.\n\nEn particular, usaremos uno de los data products, que es sobre las camas cr칤ticas disponibles a nivel nacional. Para revisar los datos, debes entrar a [esta direcci칩n](https://github.com/MinCiencia/Datos-COVID19/tree/master/output/producto20).\n\nPara esta parte, no necesitas tener cuenta creada en GitHub.\n\nCuando entres a esa secci칩n, te encontrar치s con algo similar a 칠sto:\n\n![](repo1.png){fig-align=\"center\" width=\"800\"}\n\nAdem치s del README con los detalles de los datos ac치 disponibles, ver치s 3 archivos .csv (comma separate values), que son b치sicamente los dataset con los datos. Usaremos el que tiene el sufijo `_std`, pues tiene un formato m치s f치cil de comprender para nuestros efectos.\n\nPara poder ver esos datos, hacemos clic sobre el enlace [`NumeroVentiladores_std.csv`](https://github.com/MinCiencia/Datos-COVID19/blob/master/output/producto20/NumeroVentiladores_std.csv \"NumeroVentiladores_std.csv\")`.`\n\nSe te mostrar치 la siguiente informaci칩n:\n\n![](repo2.png){fig-align=\"center\" width=\"800\"}\n\nSale una previsualizaci칩n de los datos.\n\nMe ha tocado ver a muchos que lo que hacen ac치 es copiar y pegar, sin m치s. Es decir, seleccionan con el rat칩n los datos y los copian en un Excel o algo as칤.\n\nPor favor... No hagas eso!!!! 游뱍\n\nJustamente, este art칤culo es para ello y que no cometas ese error.\n\nVamos...\n\nF칤jate que arriba a la derecha hay unos botones. Uno de ellos dice `Raw`. Dale clic.\n\n![](repo3.png){fig-align=\"center\" width=\"300\"}\n\nSe mostrar치n los datos de una forma extra침a, como todos juntos. No te asustes!!! Es normal, pues es el formato de los archivos csv.\n\n![](repo4.png){fig-align=\"center\" width=\"800\"}\n\nLo relevante ac치 es la direcci칩n web que sale en tu navegador. Esa direcci칩n es la que usaremos para nuestro c칩digo y descargar los datos, pues desde las pantallas anteriores no podr치s hacerlo de forma adecuada.\n\nAhora veamos c칩mo descargar esos datos a nuestro computador para poder usarlos en los an치lisis. Como te mencion칠, pondr칠 ejemplos tanto de Python como de R. Adem치s, har칠 un breve benchmark para revisar cu치nto se demoran los scripts en ejecutar las funciones.\n\n## Usando Python\n\nPara descargar los datos, usaremos `Pandas` y su funci칩n `read_csv()` a la cual le debemos pasar la direcci칩n web (url) donde se encuentran los datos que vimos anteriormente en formato raw.\n\nF칤jate que la url se la pasamos como un dato de tipo *string* (cadena de texto), por lo cual la tenemos que envolver con comillas.\n\nRevisemos el c칩digo:\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport pandas as pd\n\nurl = 'https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv'\nbeds_py = pd.read_csv(url)\n```\n:::\n\n::: {.cell}\n\n```{.python .cell-code}\nprint(beds_py.head())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Ventiladores       fecha  numero\n0        total  2020-04-14    1550\n1  disponibles  2020-04-14     564\n2     ocupados  2020-04-14     986\n3        total  2020-04-15    1563\n4  disponibles  2020-04-15     577\n```\n:::\n:::\n\n\nY eso es todo!!\n\nYa creamos un objeto (dataframe) con los datos desde GitHub.\n\n## Usando R\n\nAhora vemos c칩mo descargar los datos con R. La sintaxis es muy similar.\n\nUsaremos la librer칤a `reader` y su funci칩n `read_csv()`, a la cual le pasamos la url de los datos en raw. Igual que antes, se coloca la direcci칩n como un *string* (entre comillas)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\n\nurl <- \"https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv\"\nbeds_r <- read_csv(url) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(beds_r)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 칑 3\n  Ventiladores fecha      numero\n  <chr>        <date>      <dbl>\n1 total        2020-04-14   1550\n2 disponibles  2020-04-14    564\n3 ocupados     2020-04-14    986\n4 total        2020-04-15   1563\n5 disponibles  2020-04-15    577\n6 ocupados     2020-04-15    986\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(beds_r)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"spec_tbl_df\" \"tbl_df\"      \"tbl\"         \"data.frame\" \n```\n:::\n:::\n\n\nListo!!! Ya tenemos los datos.\n\nAl igual que antes, tenemos un objeto de tipo dataframe, aunque con unos peque침os detalles, pues la esta funci칩n nos devuelve un `tibble`. Si quieres indagar m치s sobre las diferencias entre un tibble y un dataframe cl치sico, puedes revisar [este enlace](https://r4ds.had.co.nz/tibbles.html). Pero para nuestros objetivos, da igual.\n\nComo puedes ver, descargar archivos desde GitHub es bastante simple y no requiere gran esfuerzo ni complicaciones. Pero quiz치s te est치s preguntando y para qu칠 quiero hacer eso? Si finalmente podr칤a tener los datos en el computador y bastar칤a.\n\nLa gracia de tener esta \"conexi칩n\" con el repositorio remoto de GitHub es que en la medida que los datos sean modificados, cada vez que ejecute el c칩digo, voy a descargar la 칰ltima versi칩n del archivo. Esto es muy 칰til para temas de automatizaciones y esas cosas. Pero como te estar치s imaginando, no lo ver칠 ahora y ya habr치 momento para revisar ese tema.\n\n## Desempe침o\n\nVimos c칩mo descargar los datos usando Python y R usando las funciones que m치s comunmente se suelen usar para ello. Los datos que descargamos son peque침os y no representan gran trabajo. La cosa se podr칤a poner m치s compleja si la cantidad de datos es mayor. Esto es importante a la hora de desplegar un script, por lo cual es interesante evaluar cu치nto demora cada funci칩n en realizar esta tarea.\n\nComo ya estamos usando estos datos, veamos c칩mo hacerlo en cada lenguaje.\n\n### Python\n\nForma 1: usando `time`\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport time\n\ntic = time.perf_counter()\nurl = 'https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv'\nbeds_py_bench1 = pd.read_csv(url)\ntoc = time.perf_counter()\n\nprint(\"Segundos: \", toc - tic) # Resulstado en milisegundos\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSegundos:  0.42979449999999986\n```\n:::\n:::\n\n\nForma 2: usando `ttictoc`\n\n\n::: {.cell}\n\n```{.python .cell-code}\nfrom ttictoc import tic,toc\n\ntic()\nurl = 'https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv'\nbeds_py_bench2 = pd.read_csv(url)\nelapsed = toc()\n\nprint(\"Segundos: \", elapsed)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSegundos:  0.1373408999999981\n```\n:::\n:::\n\n\nLos resultados pueden variar entre una ejecuci칩n y otra y se ven afectado por la calidad de la conexi칩n a internet, pero vemos que entre ambos ejemplos no hay muchas diferencias en tiempo.\n\n### R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tictoc)\n\ntic()\nurl <- \"https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv\"\nbeds_r_bench <- read_csv(url) \ntoc()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n0.59 sec elapsed\n```\n:::\n:::\n\n\nAl igual que lo mencionado antes, los resultados pueden variar entre una ejecuci칩n y otra del c칩dico. Sin embargo, al parecer esta forma es m치s lenta que en Python. Bueno, el `tidyverse` a pesar de que me encanta, no es la cosa m치s r치pida en general. Para ello, hay otras librer칤as con mejor desempe침o como `vroom` (que es parte de `tidyverse` de igual forma) y `data.table`.\n\nUsando vroom:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntic()\nurl <- \"https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv\"\nbeds_r_bench1 <- vroom::vroom(url) \ntoc()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n0.31 sec elapsed\n```\n:::\n:::\n\n\nUsando data.table:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(data.table)\n\ntic()\nurl <- \"https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv\"\nbeds_r_bench2 <- data.table::fread(url) \ntoc()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n0.47 sec elapsed\n```\n:::\n:::\n\n\nAl parecer `data.table` es m치s r치pido, al menos en este ejemplo. Hagamos algo loco... por que hasta ahora solo han sido unas cuantas ejecuciones de cada c칩digo y puede no ser muy representativo.\n\nQu칠 tal si corremos el c칩digo 1000 veces?\n\nSi, mil.\n\nPara suerte de nosotros, no tenemos que estar apretando el bot칩n todas esas veces, sino que podemos usar alguna librer칤a de *bencharking* para eso.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(microbenchmark)\n\nbench_fread <- microbenchmark(\n  url <- \"https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv\",\n  beds_fread_bench <- data.table::fread(url),\n  times = 1000\n)\n\nbench_fread\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nUnit: nanoseconds\n                                                                                                                    expr\n url <- \"https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv\"\n                                                                              beds_fread_bench <- data.table::fread(url)\n      min       lq     mean   median       uq       max neval cld\n        0        0     1277     1200     1800    169500  1000  a \n 11403400 14353300 20653423 16403350 18825850 466079000  1000   b\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbench_vroom <- microbenchmark(\n  url <- \"https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv\",\n  beds_vroom_bench <- vroom::vroom(url),\n  times = 1000\n)\n\nbench_vroom\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nUnit: nanoseconds\n                                                                                                                    expr\n url <- \"https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv\"\n                                                                                   beds_vroom_bench <- vroom::vroom(url)\n      min       lq        mean    median        uq       max neval cld\n        0        0      1191.4       100      1800     19400  1000  a \n 77591200 96365150 116003579.9 106687450 118518250 669067900  1000   b\n```\n:::\n:::\n\n\nComo he mencionado, con cada ejecuci칩n pueden variar los resultados. El output de este microbench est치 en nanosegundos. Para efectos de comparaci칩n y mejor entendimiento, usar칠 la mediana y lo pasar칠 a segundos. Dej칩 un resultado que obtuve.\n\n*Nota: los datos mostrados en las tablas del benchmark pueden diferir.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data.table\ndatatable_1000 <- 15865750 / 1.0000E+9\nprint(paste(\"Segundos:\", datatable_1000))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Segundos: 0.01586575\"\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# vroom\nvroom_1000 <- 99581050 / 1.0000E+9\nprint(paste(\"Segundos:\", vroom_1000))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Segundos: 0.09958105\"\n```\n:::\n:::\n\n\nDiferencia porcentual relativa:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(abs(vroom_1000) - abs(datatable_1000)) / ((abs(datatable_1000) + abs(vroom_1000)) / 2) * 100\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 145.0284\n```\n:::\n:::\n\n\nVemos que `data.table` es un 145% m치s r치pido. No deja de ser interesante ese dato.\n\n## Finalmente\n\nRevisamos c칩mo descargar archivos csv desde GitHub y lo hicimos tanto en Python como R.\n\nPractica tus an치lisis usando estas funciones. Investiga distintos respositorios que contengan datos y 칰salos.\n\nAdem치s, hicimos algunas comparaciones de cu치ndo demoran y vimos que hay diferencias importantes. Si bien para este ejemplo no es muy significativo, dado que el archivo es peque침o, puede llegar a ser un gran problema si no te fijas bien. El an치lisis critico y la decisi칩n de qu칠 funci칩n usar en cada momento, es algo que requiere pr치ctica y conocimientos t칠cnicos para optimizar el desempe침o del c칩digo, en especial, en tareas de mucha carga. La optimizaci칩n del c칩digo permite mejorar el rendimiento, uso de memoria y eficiencia y es un aspecto relevante en soluciones inform치ticas de mayor escala.\n\nNos vemos pronto!! 游때\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}