---
title: "쮺칩mo descargar datos desde GitHub m치s r치pido?"
description: "Vemos paso a paso c칩mo descargar archivos desde GitHub usando Python y R. Adem치s, tomamos el tiempo de cu치nto demoran!"
author: "Paulo Villarroel"
date: "2022-10-27"
categories: [tutorial, github, python, r]
image: "descarga.jpg"
---

Hola!!!

En esta ocasi칩n veremos un tema que me preguntan mucho siempre. Habitualmente cuando hago clases o alg칰n taller de programaci칩n, sale esta duda...

쮺칩mo descargar los archivos desde GitHub?

Me refiero a descargar los archivos csv alojados en GitHub para poder usarlos.

Ok.

Revisemos paso a paso c칩mo hacerlo. Y para ello, usar칠 2 lenguajes de programaci칩n que me gustan mucho: Python y R. Adem치s, que si est치s interesado/a en la ciencia de datos, los m치s seguro es que uses alguno de ellos.

Ah! Ac치 no voy a revisar c칩mo descargar todo el repositorio remoto desde GitHub (clonarlo), sino a solo un archivo que est칠 ah칤 disponible. Tampoco har칠 un an치lisis de los datos. Ya habr치 momento para eso.

Pero haremos algo entretenido, que es medir cu치nto demoran cada uno!! 游땙

## Accediendo a GitHub

Para este tutorial, usar칠 el [repositorio del Ministerio de Ciencias y Tecnolog칤a de Chile](https://github.com/MinCiencia/Datos-COVID19), que contiene muchos datos de los casos COVID-19.

En particular, usaremos uno de los data products, que es sobre las camas cr칤ticas disponibles a nivel nacional. Para revisar los datos, debes entrar a [esta direcci칩n](https://github.com/MinCiencia/Datos-COVID19/tree/master/output/producto20).

Para esta parte, no necesitas tener cuenta creada en GitHub.

Cuando entres a esa secci칩n, te encontrar치s con algo similar a 칠sto:

![](repo1.png){fig-align="center" width="800"}

Adem치s del README con los detalles de los datos ac치 disponibles, ver치s 3 archivos .csv (comma separate values), que son b치sicamente los dataset con los datos. Usaremos el que tiene el sufijo `_std`, pues tiene un formato m치s f치cil de comprender para nuestros efectos.

Para poder ver esos datos, hacemos clic sobre el enlace [`NumeroVentiladores_std.csv`](https://github.com/MinCiencia/Datos-COVID19/blob/master/output/producto20/NumeroVentiladores_std.csv "NumeroVentiladores_std.csv")`.`

Se te mostrar치 la siguiente informaci칩n:

![](repo2.png){fig-align="center" width="800"}

Sale una previsualizaci칩n de los datos.

Me ha tocado ver a muchos que lo que hacen ac치 es copiar y pegar, sin m치s. Es decir, seleccionan con el rat칩n los datos y los copian en un Excel o algo as칤.

Por favor... No hagas eso!!!! 游뱍

Justamente, este art칤culo es para ello y que no cometas ese error.

Vamos...

F칤jate que arriba a la derecha hay unos botones. Uno de ellos dice `Raw`. Dale clic.

![](repo3.png){fig-align="center" width="300"}

Se mostrar치n los datos de una forma extra침a, como todos juntos. No te asustes!!! Es normal, pues es el formato de los archivos csv.

![](repo4.png){fig-align="center" width="800"}

Lo relevante ac치 es la direcci칩n web que sale en tu navegador. Esa direcci칩n es la que usaremos para nuestro c칩digo y descargar los datos, pues desde las pantallas anteriores no podr치s hacerlo de forma adecuada.

Ahora veamos c칩mo descargar esos datos a nuestro computador para poder usarlos en los an치lisis. Como te mencion칠, pondr칠 ejemplos tanto de Python como de R. Adem치s, har칠 un breve benchmark para revisar cu치nto se demoran los scripts en ejecutar las funciones.

## Usando Python

Para descargar los datos, usaremos `Pandas` y su funci칩n `read_csv()` a la cual le debemos pasar la direcci칩n web (url) donde se encuentran los datos que vimos anteriormente en formato raw.

F칤jate que la url se la pasamos como un dato de tipo *string* (cadena de texto), por lo cual la tenemos que envolver con comillas.

Revisemos el c칩digo:

```{python}
import pandas as pd

url = 'https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv'
beds_py = pd.read_csv(url)
```

```{python}
print(beds_py.head())
```

Y eso es todo!!

Ya creamos un objeto (dataframe) con los datos desde GitHub.

## Usando R

Ahora vemos c칩mo descargar los datos con R. La sintaxis es muy similar.

Usaremos la librer칤a `reader` y su funci칩n `read_csv()`, a la cual le pasamos la url de los datos en raw. Igual que antes, se coloca la direcci칩n como un *string* (entre comillas)

```{r}
#| warning: false

library(readr)

url <- "https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv"
beds_r <- read_csv(url) 
```

```{r}
head(beds_r)
```

```{r}
class(beds_r)
```

Listo!!! Ya tenemos los datos.

Al igual que antes, tenemos un objeto de tipo dataframe, aunque con unos peque침os detalles, pues la esta funci칩n nos devuelve un `tibble`. Si quieres indagar m치s sobre las diferencias entre un tibble y un dataframe cl치sico, puedes revisar [este enlace](https://r4ds.had.co.nz/tibbles.html). Pero para nuestros objetivos, da igual.

Como puedes ver, descargar archivos desde GitHub es bastante simple y no requiere gran esfuerzo ni complicaciones. Pero quiz치s te est치s preguntando y para qu칠 quiero hacer eso? Si finalmente podr칤a tener los datos en el computador y bastar칤a.

La gracia de tener esta "conexi칩n" con el repositorio remoto de GitHub es que en la medida que los datos sean modificados, cada vez que ejecute el c칩digo, voy a descargar la 칰ltima versi칩n del archivo. Esto es muy 칰til para temas de automatizaciones y esas cosas. Pero como te estar치s imaginando, no lo ver칠 ahora y ya habr치 momento para revisar ese tema.

## Desempe침o

Vimos c칩mo descargar los datos usando Python y R usando las funciones que m치s comunmente se suelen usar para ello. Los datos que descargamos son peque침os y no representan gran trabajo. La cosa se podr칤a poner m치s compleja si la cantidad de datos es mayor. Esto es importante a la hora de desplegar un script, por lo cual es interesante evaluar cu치nto demora cada funci칩n en realizar esta tarea.

Como ya estamos usando estos datos, veamos c칩mo hacerlo en cada lenguaje.

### Python

Forma 1: usando `time`

```{python}
import time

tic = time.perf_counter()
url = 'https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv'
beds_py_bench1 = pd.read_csv(url)
toc = time.perf_counter()

print("Segundos: ", toc - tic) # Resulstado en milisegundos
```

Forma 2: usando `ttictoc`

```{python}
from ttictoc import tic,toc

tic()
url = 'https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv'
beds_py_bench2 = pd.read_csv(url)
elapsed = toc()

print("Segundos: ", elapsed)
```

Los resultados pueden variar entre una ejecuci칩n y otra y se ven afectado por la calidad de la conexi칩n a internet, pero vemos que entre ambos ejemplos no hay muchas diferencias en tiempo.

### R

```{r}
#| warning: false

library(tictoc)

tic()
url <- "https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv"
beds_r_bench <- read_csv(url) 
toc()
```

Al igual que lo mencionado antes, los resultados pueden variar entre una ejecuci칩n y otra del c칩dico. Sin embargo, al parecer esta forma es m치s lenta que en Python. Bueno, el `tidyverse` a pesar de que me encanta, no es la cosa m치s r치pida en general. Para ello, hay otras librer칤as con mejor desempe침o como `vroom` (que es parte de `tidyverse` de igual forma) y `data.table`.

Usando vroom:

```{r}
#| warning: false

tic()
url <- "https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv"
beds_r_bench1 <- vroom::vroom(url) 
toc()
```

Usando data.table:

```{r}
#| warning: false

library(data.table)

tic()
url <- "https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv"
beds_r_bench2 <- data.table::fread(url) 
toc()
```

Al parecer `data.table` es m치s r치pido, al menos en este ejemplo. Hagamos algo loco... por que hasta ahora solo han sido unas cuantas ejecuciones de cada c칩digo y puede no ser muy representativo.

Qu칠 tal si corremos el c칩digo 1000 veces?

Si, mil.

Para suerte de nosotros, no tenemos que estar apretando el bot칩n todas esas veces, sino que podemos usar alguna librer칤a de *bencharking* para eso.

```{r}
#| warning: false

library(microbenchmark)

bench_fread <- microbenchmark(
  url <- "https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv",
  beds_fread_bench <- data.table::fread(url),
  times = 1000
)

bench_fread
```

```{r}
#| warning: false

bench_vroom <- microbenchmark(
  url <- "https://raw.githubusercontent.com/MinCiencia/Datos-COVID19/master/output/producto20/NumeroVentiladores_std.csv",
  beds_vroom_bench <- vroom::vroom(url),
  times = 1000
)

bench_vroom
```

Como he mencionado, con cada ejecuci칩n pueden variar los resultados. El output de este microbench est치 en nanosegundos. Para efectos de comparaci칩n y mejor entendimiento, usar칠 la mediana y lo pasar칠 a segundos. Dej칩 un resultado que obtuve.

*Nota: los datos mostrados en las tablas del benchmark pueden diferir.*

```{r}
# data.table
datatable_1000 <- 15865750 / 1.0000E+9
print(paste("Segundos:", datatable_1000))
```

```{r}
# vroom
vroom_1000 <- 99581050 / 1.0000E+9
print(paste("Segundos:", vroom_1000))
```

Diferencia porcentual relativa:

```{r}
(abs(vroom_1000) - abs(datatable_1000)) / ((abs(datatable_1000) + abs(vroom_1000)) / 2) * 100
```

Vemos que `data.table` es un 145% m치s r치pido. No deja de ser interesante ese dato.

## Finalmente

Revisamos c칩mo descargar archivos csv desde GitHub y lo hicimos tanto en Python como R.

Practica tus an치lisis usando estas funciones. Investiga distintos respositorios que contengan datos y 칰salos.

Adem치s, hicimos algunas comparaciones de cu치ndo demoran y vimos que hay diferencias importantes. Si bien para este ejemplo no es muy significativo, dado que el archivo es peque침o, puede llegar a ser un gran problema si no te fijas bien. El an치lisis critico y la decisi칩n de qu칠 funci칩n usar en cada momento, es algo que requiere pr치ctica y conocimientos t칠cnicos para optimizar el desempe침o del c칩digo, en especial, en tareas de mucha carga. La optimizaci칩n del c칩digo permite mejorar el rendimiento, uso de memoria y eficiencia y es un aspecto relevante en soluciones inform치ticas de mayor escala.

Nos vemos pronto!! 游때
